<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.ga.greenApple.mapper.ReviewMapper">
	
	<!-- 리뷰 리스트 -->
	<!-- resultType은 dto의 alias와 일치해야한다 -->
	<select id="rvList" resultType="review" parameterType="integer">
		select * from review where productCode = #{productCode} and del != 'y'
			order by reviewId desc
	</select>
	
	<!-- reviewId에 따른 이미지 -->
	<select id="imgList" resultType="reviewImg" parameterType="string">
		select * from review_img where reviewId = #{reviewId}
	</select>
	
	<!-- 리스트나 뷰에 쓰일 리뷰 갯수 -->
	<select id="reviewNum" resultType="integer" parameterType="integer">
		select count(reviewId) from review 
			where productCode = #{productCode} and del != 'y'
	</select>
	
	<!-- 리뷰 작성 -->
	<insert id="rvInsert" parameterType="review">
		insert into review values( #{reviewId}, #{id}, #{productCode}, 
			#{content}, #{fileName}, sysdate, 'n' )
	</insert>
	
	<!-- 리뷰 작성 (사진) -->
	<insert id="insertRvPhoto" parameterType="reviewImg">
		insert into review_img values(review_image_seq.nextval,
			#{reviewId}, #{id}, #{fileName} )
	</insert>
	
	<!-- 리뷰 수정/삭제 시 작성자 id 찾기 (비교용) -->
	<select id="findWriteId" resultType="string" parameterType="string">
		select id from review where reviewId = #{reviewId}
	</select>
	
	<!-- 리뷰 수정 -->
	<update id="rvUpdate" parameterType="review">
		update review set content = #{content}
			<if test="fileName != null">
				, fileName = #{fileName}
			</if> 
			where reviewId = #{reviewId}
	</update>
	
	<!-- 리뷰 삭제 -->
	<update id="rvDelete" parameterType="string">
		update review set del = 'y' where reviewId = #{reviewId}
	</update>
	
</mapper>